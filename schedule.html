<!DOCTYPE html>
<html>
<head>
  <title>Class Schedule</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">

  <style>
    table tbody tr:hover { background-color: #f0f8ff; cursor: pointer; }
    input, select, button { border-radius: 8px; }
    .card { border-radius: 12px; }
    .badge-subject { padding: 0.5em; color: white; border-radius: 6px; }
    .badge-math { background-color: #0d6efd; }
    .badge-science { background-color: #198754; }
    .badge-english { background-color: #ffc107; color: black; }
  </style>
</head>
<body class="p-4 bg-light">

<div class="container">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>ðŸ“… Class Schedule</h2>
    <a href="dashboard.html" class="btn btn-secondary">Back</a>
  </div>

  <!-- Add/Edit Class Form -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-primary text-white">Add / Edit Class</div>
    <div class="card-body">
      <form id="scheduleForm" class="row g-3">

        <div class="col-md-3">
          <label class="form-label">Subject</label>
          <input type="text" class="form-control" id="subject" placeholder="e.g. Math" required>
        </div>

        <div class="col-md-2">
          <label class="form-label">Day</label>
          <select class="form-select" id="day" required>
            <option value="">Select Day</option>
            <option>Monday</option>
            <option>Tuesday</option>
            <option>Wednesday</option>
            <option>Thursday</option>
            <option>Friday</option>
          </select>
        </div>

        <div class="col-md-2">
          <label class="form-label">Start Time</label>
          <input type="time" class="form-control" id="startTime" required>
        </div>

        <div class="col-md-2">
          <label class="form-label">End Time</label>
          <input type="time" class="form-control" id="endTime" required>
        </div>

        <div class="col-md-2">
          <label class="form-label">Room</label>
          <input type="text" class="form-control" id="room" placeholder="e.g. Room 101" required>
        </div>

        <div class="col-md-1">
          <label class="form-label">Lecturer</label>
          <input type="text" class="form-control" id="lecturer" placeholder="Mr. Ali" required>
        </div>

        <div class="col-12">
          <button class="btn btn-success w-100">Save Class</button>
        </div>

      </form>
    </div>
  </div>

  <!-- Schedule Table -->
  <div class="card shadow-sm">
    <div class="card-body">
      <table class="table table-hover">
        <thead class="table-dark">
          <tr>
            <th>Subject</th>
            <th>Day</th>
            <th>Time</th>
            <th>Room</th>
            <th>Lecturer</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="scheduleTable"></tbody>
      </table>
    </div>
  </div>

</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDpzuExZHIX9VR9ykKQB-6tpxnzRU3WxTQ",
    authDomain: "studentplanner-d0933.firebaseapp.com",
    projectId: "studentplanner-d0933",
    storageBucket: "studentplanner-d0933.firebasestorage.app",
    messagingSenderId: "734911455270",
    appId: "1:734911455270:web:a5f0381a14c6d3fb31c6e7"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const table = document.getElementById("scheduleTable");
  const form = document.getElementById("scheduleForm");

  const subjectInput = document.getElementById("subject");
  const dayInput = document.getElementById("day");
  const startTimeInput = document.getElementById("startTime");
  const endTimeInput = document.getElementById("endTime");
  const roomInput = document.getElementById("room");
  const lecturerInput = document.getElementById("lecturer");

  let editId = null;

  function loadSchedule() {
    table.innerHTML = "";
    db.collection("schedule").orderBy("day").get()
      .then(snapshot => {
        snapshot.forEach(doc => {
          const data = doc.data();

          // Fallback for old entries
          const subject = data.subject || data.Subject || "-";
          const day = data.day || data.Day || "-";
          const time = data.time || data.Time || "-";
          const room = data.room || data.Room || data.Classroom || "-";
          const lecturer = data.lecturer || data.Lecturer || "-";

          const row = document.createElement("tr");

          // Badge for subject
          let badgeClass = "badge-subject bg-secondary";
          if(subject.toLowerCase().includes("math")) badgeClass = "badge-subject badge-math";
          else if(subject.toLowerCase().includes("science")) badgeClass = "badge-subject badge-science";
          else if(subject.toLowerCase().includes("english")) badgeClass = "badge-subject badge-english";

          row.innerHTML = `
            <td><span class="${badgeClass}">${subject}</span></td>
            <td>${day}</td>
            <td>${time}</td>
            <td>${room}</td>
            <td>${lecturer}</td>
            <td>
              <button class="btn btn-sm btn-warning me-1">Edit</button>
              <button class="btn btn-sm btn-danger">Delete</button>
            </td>
          `;

          // Edit
          row.querySelector(".btn-warning").addEventListener("click", () => {
            subjectInput.value = subject;
            dayInput.value = day;

            // Split time for start/end inputs
            const times = time.split(" - ");
            startTimeInput.value = times[0] || "";
            endTimeInput.value = times[1] || "";

            roomInput.value = room;
            lecturerInput.value = lecturer;
            editId = doc.id;
          });

          // Delete
          row.querySelector(".btn-danger").addEventListener("click", () => {
            if(confirm(`Delete ${subject} on ${day}?`)) {
              db.collection("schedule").doc(doc.id).delete().then(loadSchedule);
            }
          });

          table.appendChild(row);
        });
      });
  }

  loadSchedule(); // initial load

  // Add / Edit Schedule
  form.addEventListener("submit", e => {
    e.preventDefault();
    const timeRange = `${startTimeInput.value} - ${endTimeInput.value}`;
    const scheduleData = {
      subject: subjectInput.value,
      day: dayInput.value,
      time: timeRange,
      room: roomInput.value,
      lecturer: lecturerInput.value
    };

    if(editId) {
      db.collection("schedule").doc(editId).set(scheduleData).then(() => {
        form.reset();
        editId = null;
        loadSchedule();
      });
    } else {
      db.collection("schedule").add(scheduleData).then(() => {
        form.reset();
        loadSchedule();
      });
    }
  });
</script>

</body>
</html>
